<!DOCTYPE html>
<html>
<head>
  <title>Chi tiết đánh giá</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .review-card { margin-bottom: 1.5rem; }
    .feedback-card { 
      background-color: #f8f9fa; 
      border-left: 4px solid #0dcaf0; 
      margin-top: 1rem; 
      margin-left: 2rem;
    }
  </style>
</head>
<body class="container mt-4">
  <h2>Đánh giá cho: <%= room.roomName %></h2>
  <a href="/provider/reviews">&larr; Quay lại danh sách phòng</a>

  <hr>

  <% if (room.Reviews.length > 0) { %>
    <% room.Reviews.forEach(review => { %>
      <div class="card review-card">
        <div class="card-body">
          <h5 class="card-title"><%= review.Customer.fullName %></h5>
          <h6 class="card-subtitle mb-2 text-muted">
            Xếp hạng: <strong><%= review.rating %>/5</strong> | 
            Ngày: <%= new Date(review.reviewDate).toLocaleDateString('vi-VN') %>
          </h6>
          <p class="card-text"><%= review.comment %></p>

          <% if (review.Feedback) { %>
            <div class="card feedback-card">
              <div class="card-body">
                <strong class="text-info">Phản hồi của bạn:</strong>
                <p class="mb-0"><%= review.Feedback.message %></p>
                <small class="text-muted">Ngày: <%= new Date(review.Feedback.feedbackDate).toLocaleDateString('vi-VN') %></small>
              </div>
            </div>
          <% } else { %>
            <form action="/provider/reviews/feedback" method="POST" class="mt-3">
              <input type="hidden" name="reviewId" value="<%= review.reviewId %>">
              <input type="hidden" name="roomId" value="<%= room.roomId %>"> <div class="mb-2">
                <textarea name="message" class="form-control" rows="3" placeholder="Nhập phản hồi của bạn..." required></textarea>
              </div>
              <button type="submit" class="btn btn-primary btn-sm">Gửi phản hồi</button>
            </form>
          <% } %>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <p class="text-muted">Phòng này chưa có đánh giá nào.</p>
  <% } %>

</body>
</html>