<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Ch·ªânh s·ª≠a th√¥ng tin ph√≤ng</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .form-container {
        background-color: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        background-color: #007bff;
      }
    </style>
  </head>
  <body class="container py-5">
    <div class="form-container mx-auto col-md-8">
      <h2 class="text-center mb-4">üõ†Ô∏è Ch·ªânh s·ª≠a th√¥ng tin ph√≤ng</h2>

      <form
        action="/provider/edit-room/<%= room.roomId %>"
        method="POST"
        enctype="multipart/form-data"
        id="editRoomForm"
      >
        <!-- T√™n ph√≤ng -->
        <div class="mb-3">
          <label for="roomName" class="form-label">T√™n ph√≤ng</label>
          <input
            type="text"
            class="form-control"
            id="roomName"
            name="roomName"
            value="<%= room.roomName %>"
            required
          />
        </div>

        <!-- ƒê·ªãa ch·ªâ -->
        <div class="mb-3">
          <label for="fullAddress" class="form-label">ƒê·ªãa ch·ªâ</label>
          <input
            type="text"
            class="form-control"
            id="fullAddress"
            name="fullAddress"
            value="<%= room.fullAddress %>"
            required
          />
        </div>

        <!-- S·ª©c ch·ª©a -->
        <div class="mb-3">
          <label for="capacity" class="form-label">S·ª©c ch·ª©a (ng∆∞·ªùi)</label>
          <input
            type="number"
            class="form-control"
            id="capacity"
            name="capacity"
            value="<%= room.capacity %>"
            min="1"
            required
          />
        </div>

        <!-- Gi√° -->
        <div class="mb-3">
          <label for="price" class="form-label">Gi√° (VND)</label>
          <input
            type="number"
            class="form-control"
            id="price"
            name="price"
            value="<%= room.price %>"
            min="1"
            required
          />
        </div>

        <!-- Ti·ªán √≠ch -->
        <div class="mb-3">
          <label for="amenities" class="form-label">Ti·ªán √≠ch</label>
          <input
            type="text"
            class="form-control"
            id="amenities"
            name="amenities"
            value="<%= room.amenities %>"
            required
          />
        </div>

        <!-- M√¥ t·∫£ -->
        <div class="mb-3">
          <label for="description" class="form-label">M√¥ t·∫£ chi ti·∫øt</label>
          <textarea
            class="form-control"
            id="description"
            name="description"
            rows="4"
            required
          >
<%= room.description %></textarea
          >
        </div>

        <!-- ·∫¢nh hi·ªán t·∫°i -->
        <div class="mb-3">
          <label class="form-label">·∫¢nh hi·ªán t·∫°i:</label><br />
          <% if (room.image) { %>
          <img
            src="/<%= room.image %>"
            alt="·∫¢nh ph√≤ng"
            width="250"
            class="rounded shadow mb-2"
          />
          <% } else { %>
          <p class="text-muted">Ch∆∞a c√≥ ·∫£nh</p>
          <% } %>
        </div>

        <!-- ·∫¢nh m·ªõi -->
        <div class="mb-3">
          <label for="images" class="form-label"
            >C·∫≠p nh·∫≠t ·∫£nh m·ªõi (n·∫øu c√≥):</label
          >
          <input
            type="file"
            class="form-control"
            id="images"
            name="images"
            multiple
            accept="image/*"
          />
        </div>

        <!-- N√∫t h√†nh ƒë·ªông -->
        <div class="text-center mt-4">
          <button type="submit" class="btn btn-primary px-4">
            üíæ L∆∞u thay ƒë·ªïi
          </button>
          <a href="/provider/dashboard" class="btn btn-secondary ms-3 px-4">
            H·ªßy
          </a>
        </div>
      </form>
    </div>

    <script>
      // ‚úÖ Th√¥ng b√°o x√°c nh·∫≠n khi b·∫•m "L∆∞u thay ƒë·ªïi"
      document
        .getElementById("editRoomForm")
        .addEventListener("submit", function (e) {
          const confirmSubmit = confirm(
            "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën l∆∞u thay ƒë·ªïi cho ph√≤ng n√†y kh√¥ng?\nSau khi l∆∞u, tr·∫°ng th√°i s·∫Ω chuy·ªÉn v·ªÅ 'Ch·ªù duy·ªát'."
          );
          if (!confirmSubmit) {
            e.preventDefault();
            return;
          }

          // ‚úÖ Ki·ªÉm tra h·ª£p l·ªá d·ªØ li·ªáu tr∆∞·ªõc khi g·ª≠i
          const roomName = document.getElementById("roomName").value.trim();
          const fullAddress = document
            .getElementById("fullAddress")
            .value.trim();
          const price = parseFloat(document.getElementById("price").value);
          const capacity = parseInt(
            document.getElementById("capacity").value,
            10
          );
          const amenities = document.getElementById("amenities").value.trim();
          const description = document
            .getElementById("description")
            .value.trim();
          const images = document.getElementById("images").files;

          const roomNameRegex = /^[a-zA-Z√Ä-·ªπ0-9\s]+$/;
          const errors = [];

          if (!roomNameRegex.test(roomName)) {
            errors.push("T√™n ph√≤ng kh√¥ng h·ª£p l·ªá. Kh√¥ng ch·ª©a k√Ω t·ª± ƒë·∫∑c bi·ªát.");
          }

          if (!fullAddress) {
            errors.push("ƒê·ªãa ch·ªâ kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.");
          }

          if (isNaN(price) || price <= 0) {
            errors.push("Gi√° ph√≤ng ph·∫£i l√† s·ªë > 0.");
          }

          if (isNaN(capacity) || capacity < 1) {
            errors.push("S·ª©c ch·ª©a ph·∫£i ‚â• 1.");
          }

          if (!amenities) {
            errors.push("Vui l√≤ng nh·∫≠p ti·ªán √≠ch c·ªßa ph√≤ng.");
          }

          if (!description) {
            errors.push("Vui l√≤ng nh·∫≠p m√¥ t·∫£ chi ti·∫øt.");
          }

          // Ki·ªÉm tra ƒë·ªãnh d·∫°ng ·∫£nh m·ªõi (n·∫øu c√≥)
          if (images.length > 0) {
            const allowed = ["image/jpeg", "image/png", "image/jpg"];
            for (let img of images) {
              if (!allowed.includes(img.type)) {
                errors.push(
                  "·∫¢nh kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng (.jpg, .jpeg, .png): " + img.name
                );
              }
            }
          }

          if (errors.length > 0) {
            e.preventDefault();
            alert(errors.join("\n"));
          }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
