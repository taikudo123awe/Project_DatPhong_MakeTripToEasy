<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>üõ†Ô∏è Ch·ªânh s·ª≠a th√¥ng tin ph√≤ng</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #fafafa;
      }
      .form-container {
        background-color: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>

  <body class="container py-5">
    <div class="form-container mx-auto col-md-8">
      <h2 class="text-center mb-4">üõ†Ô∏è Ch·ªânh s·ª≠a th√¥ng tin ph√≤ng</h2>

      <% if (error) { %>
        <div class="alert alert-danger"><%- error %></div>
      <% } %>

      <% if (typeof errors !== 'undefined' && errors._general) { %>
        <div class="alert alert-danger"><%= errors._general %></div>
      <% } %>

      <form
        method="POST"
        action="/provider/edit-room/<%= room.roomId %>"
        enctype="multipart/form-data"
        id="editRoomForm"
        class="card p-4 shadow-sm"
      >
        <!-- üè† T√™n ph√≤ng -->
        <div class="mb-3">
          <label for="roomName" class="form-label">T√™n ph√≤ng</label>
          <input
            type="text"
            class="form-control <%= errors?.roomName ? 'is-invalid' : '' %>"
            id="roomName"
            name="roomName"
            value="<%= oldData?.roomName || room.roomName || '' %>"
          />
          <% if (errors?.roomName) { %>
            <div class="invalid-feedback"><%= errors.roomName %></div>
          <% } %>
        </div>

        <!-- üèôÔ∏è ƒê·ªãa ch·ªâ -->
        <div class="mb-3">
          <label class="form-label">ƒê·ªãa ch·ªâ ph√≤ng</label>

          <div class="row">
            <div class="col-md-4">
              <label for="city" class="form-label">Th√†nh ph·ªë</label>
              <select
                id="city"
                class="form-select"
                data-current="<%= room.address ? room.address.city : '' %>"
              >
                <option value="">-- Ch·ªçn th√†nh ph·ªë --</option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="district" class="form-label">Qu·∫≠n/Huy·ªán</label>
              <select
                id="district"
                class="form-select"
                data-current="<%= room.address ? room.address.district : '' %>"
              >
                <option value="">-- Ch·ªçn qu·∫≠n/huy·ªán --</option>
              </select>
            </div>

            <div class="col-md-4">
              <label for="ward" class="form-label">Ph∆∞·ªùng/X√£</label>
              <select
                id="ward"
                class="form-select"
                data-current="<%= room.address ? room.address.ward : '' %>"
              >
                <option value="">-- Ch·ªçn ph∆∞·ªùng/x√£ --</option>
              </select>
            </div>
          </div>

          <div class="mt-3">
            <label for="customAddress" class="form-label">T√™n ƒë∆∞·ªùng / S·ªë nh√†</label>
            <input
              type="text"
              class="form-control <%= errors?.customAddress ? 'is-invalid' : '' %>"
              id="customAddress"
              name="customAddress"
              value="<%= oldData?.customAddress || (room.fullAddress ? room.fullAddress.split(',')[0].trim() : '') %>"
              placeholder="VD: 12 Nguy·ªÖn Tr√£i"
            />
            <% if (errors?.customAddress) { %>
              <div class="invalid-feedback"><%= errors.customAddress %></div>
            <% } %>
          </div>

          <input type="hidden" name="city" id="cityName" value="<%= room.address ? room.address.city : '' %>" />
          <input type="hidden" name="district" id="districtName" value="<%= room.address ? room.address.district : '' %>" />
          <input type="hidden" name="ward" id="wardName" value="<%= room.address ? room.address.ward : '' %>" />
          <input type="hidden" name="fullAddress" id="fullAddress" value="<%= room.fullAddress || '' %>" />
        </div>

        <!-- üë• S·ª©c ch·ª©a -->
        <div class="mb-3">
          <label for="capacity" class="form-label">S·ª©c ch·ª©a (ng∆∞·ªùi)</label>
          <select
            id="capacity"
            name="capacity"
            class="form-select <%= errors?.capacity ? 'is-invalid' : '' %>"
          >
            <option value="">-- Ch·ªçn s·ª©c ch·ª©a --</option>
            <% for (let i = 1; i <= 20; i++) { %>
              <option value="<%= i %>" <%= (oldData?.capacity || room.capacity) == i ? 'selected' : '' %>><%= i %> ng∆∞·ªùi</option>
            <% } %>
          </select>
          <% if (errors?.capacity) { %>
            <div class="invalid-feedback"><%= errors.capacity %></div>
          <% } %>
        </div>

        <!-- üí∞ Gi√° -->
        <div class="mb-3">
          <label for="price" class="form-label">Gi√° (VND)</label>
          <input
            type="number"
            id="price"
            name="price"
            min="1"
            class="form-control <%= errors?.price ? 'is-invalid' : '' %>"
            value="<%= oldData?.price || room.price || '' %>"
          />
          <% if (errors?.price) { %>
            <div class="invalid-feedback"><%= errors.price %></div>
          <% } %>
        </div>

        <!-- üõ†Ô∏è Ti·ªán √≠ch -->
        <div class="mb-3">
          <label for="amenities" class="form-label">Ti·ªán √≠ch</label>
          <input
            type="text"
            id="amenities"
            name="amenities"
            class="form-control <%= errors?.amenities ? 'is-invalid' : '' %>"
            value="<%= oldData?.amenities || room.amenities || '' %>"
            placeholder="VD: M√°y l·∫°nh, WiFi, TV..."
          />
          <% if (errors?.amenities) { %>
            <div class="invalid-feedback"><%= errors.amenities %></div>
          <% } %>
        </div>

        <!-- üìù M√¥ t·∫£ -->
        <div class="mb-3">
          <label for="description" class="form-label">M√¥ t·∫£ chi ti·∫øt</label>
          <textarea
            id="description"
            name="description"
            rows="4"
            class="form-control <%= errors?.description ? 'is-invalid' : '' %>"
          ><%= oldData?.description || room.description || '' %></textarea>
          <% if (errors?.description) { %>
            <div class="invalid-feedback"><%= errors.description %></div>
          <% } %>
        </div>

        <!-- üñºÔ∏è ·∫¢nh hi·ªán t·∫°i -->
        <div class="mb-3">
          <label class="form-label">·∫¢nh hi·ªán t·∫°i:</label><br />
          <% if (room.image) { 
            const imgs = room.image.split(';').filter(i => i.trim() !== '');
          %>
            <% imgs.forEach(img => { %>
              <img src="/<%= img %>" alt="·∫¢nh ph√≤ng" width="150" class="rounded shadow me-2 mb-2" />
            <% }) %>
          <% } else { %>
            <p class="text-muted">Ch∆∞a c√≥ ·∫£nh</p>
          <% } %>
        </div>

        <!-- ·∫¢nh m·ªõi -->
        <div class="mb-3">
          <label for="images" class="form-label">C·∫≠p nh·∫≠t ·∫£nh m·ªõi (n·∫øu c√≥):</label>
          <input
            type="file"
            id="images"
            name="images"
            multiple
            accept="image/*"
            class="form-control <%= errors?.images ? 'is-invalid' : '' %>"
          />
          <% if (errors?.images) { %>
            <div class="invalid-feedback"><%= errors.images %></div>
          <% } %>
        </div>

        <!-- N√∫t -->
        <div class="text-center mt-4">
          <button type="submit" class="btn btn-success px-4">üíæ L∆∞u thay ƒë·ªïi</button>
          <a href="/provider/dashboard" class="btn btn-secondary ms-3 px-4">H·ªßy</a>
        </div>
      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/javascript/addressAPI.js"></script>
  </body>
</html>
