<!DOCTYPE html>
<html>
<head>
  <title>Quản lý đơn đặt phòng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .tab-content { margin-top: 1.5rem; }
  </style>
</head>
<body class="container mt-4">
  <h2>Quản lý đơn đặt phòng</h2>
  <a href="/provider/dashboard">&larr; Quay lại Dashboard</a>

  <ul class="nav nav-pills mt-4" id="bookingTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="pending-tab" data-bs-toggle="pill" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="true">
        <span class="badge bg-warning text-dark me-1"><%= pendingBookings.length %></span> Chờ nhận phòng
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="inuse-tab" data-bs-toggle="pill" data-bs-target="#inuse" type="button" role="tab" aria-controls="inuse" aria-selected="false">
         <span class="badge bg-info me-1"><%= inUseBookings.length %></span> Đang sử dụng
      </button>
    </li>
    
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="completed-tab" data-bs-toggle="pill" data-bs-target="#completed" type="button" role="tab" aria-controls="completed" aria-selected="false">
         <span class="badge bg-success me-1"><%= completedBookings.length %></span> Đã hoàn thành
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="cancelled-tab" data-bs-toggle="pill" data-bs-target="#cancelled" type="button" role="tab" aria-controls="cancelled" aria-selected="false">
         <span class="badge bg-danger me-1"><%= cancelledBookings.length %></span> Đã hủy
      </button>
    </li>
  </ul>

  <div class="tab-content" id="bookingTabsContent">

    <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
        </div>
    <div class="tab-pane fade" id="inuse" role="tabpanel" aria-labelledby="inuse-tab">
        </div>

    <div class="tab-pane fade" id="completed" role="tabpanel" aria-labelledby="completed-tab">
      <table class="table table-hover table-bordered">
        <thead class="table-light">
          <tr>
            <th>Ngày nhận phòng</th>
            <th>Phòng</th>
            <th>Tên khách hàng</th>
            <th>Trạng thái Hóa đơn</th>
            <th>Hành động</th>
          </tr>
        </thead>
        <tbody>
          <% if (completedBookings.length > 0) { %>
            <% completedBookings.forEach(booking => { %>
              <tr>
                <td><%= new Date(booking.checkInDate).toLocaleDateString('vi-VN') %></td>
                <td><%= booking.Room.roomName %></td>
                <td><%= booking.Customer.fullName %></td>
                <td>
                  <% if (booking.Invoice && booking.Invoice.status === 'Đã thanh toán') { %>
                    <span class="badge bg-success"><%= booking.Invoice.status %></span>
                  <% } else { %>
                    <span class="badge bg-warning text-dark"><%= booking.Invoice ? booking.Invoice.status : 'N/A' %></span>
                  <% } %>
                </td>
                <td>
                  <a href="/provider/bookings/<%= booking.bookingId %>" class="btn btn-secondary btn-sm disabled">Xem chi tiết</a>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="5" class="text-center text-muted">Không có đơn nào đã hoàn thành.</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
    <div class="tab-pane fade" id="cancelled" role="tabpanel" aria-labelledby="cancelled-tab">
        </div>

  </div> <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>