<%- include('../partials/header') %>

<style>
    .tab-content { margin-top: 1.5rem; }
    .card-booking { margin-bottom: 1rem; border-left: 5px solid #6c757d; /* Màu mặc định */ }
    .status-unpaid { border-left-color: #ffc107 !important; } /* Quan trọng: Ghi đè màu mặc định */
    .status-paid { border-left-color: #198754 !important; }
    .status-cancelled { border-left-color: #dc3545 !important; }
    .status-inuse { border-left-color: #0dcaf0 !important; }
    .status-pending { border-left-color: #fd7e14 !important; } /* Thêm màu cho Chờ nhận phòng */
</style>

<main class="container mt-4">
    <h2>Thanh toán phiếu đặt phòng của bạn</h2>

    <ul class="nav nav-tabs mt-4" id="bookingHistoryTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab" aria-controls="all" aria-selected="true">Tất cả (<%= allBookings.length %>)</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="unpaid-tab" data-bs-toggle="tab" data-bs-target="#unpaid" type="button" role="tab" aria-controls="unpaid" aria-selected="false">Chưa thanh toán (<%= unpaidBookings.length %>)</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="paid-tab" data-bs-toggle="tab" data-bs-target="#paid" type="button" role="tab" aria-controls="paid" aria-selected="false">Đã thanh toán (<%= paidBookings.length %>)</button>
        </li>
         <li class="nav-item" role="presentation">
            <button class="nav-link" id="cancelled-tab" data-bs-toggle="tab" data-bs-target="#cancelled" type="button" role="tab" aria-controls="cancelled" aria-selected="false">Đã hủy (<%= cancelledBookings.length %>)</button>
        </li>
    </ul>

    <div class="tab-content" id="bookingHistoryTabsContent">

        <div class="tab-pane fade show active" id="all" role="tabpanel" aria-labelledby="all-tab">
            <% if (allBookings.length === 0) { %>
                <p class="text-muted">Bạn chưa có phiếu đặt phòng nào.</p>
            <% } else { %>
                <% allBookings.forEach(booking => { %>
                    <%- include('booking_card', { booking: booking, showCheckbox: false }) %>
                <% }) %>
            <% } %>
        </div>

        <div class="tab-pane fade" id="unpaid" role="tabpanel" aria-labelledby="unpaid-tab">
            <% if (unpaidBookings.length === 0) { %>
                <p class="text-muted">Không có hóa đơn nào chờ thanh toán.</p>
            <% } else { %>
                <form action="/customer/payment" method="POST">
                    <% unpaidBookings.forEach(booking => { %>
                        <%- include('booking_card', { booking: booking, showCheckbox: true }) %>
                    <% }) %>
                    <button type="submit" class="btn btn-primary mt-3">Thanh toán hóa đơn đã chọn</button>
                </form>
            <% } %>
        </div>

        <div class="tab-pane fade" id="paid" role="tabpanel" aria-labelledby="paid-tab">
             <% if (paidBookings.length === 0) { %>
                <p class="text-muted">Chưa có phiếu đặt phòng nào đã thanh toán.</p>
            <% } else { %>
                <% paidBookings.forEach(booking => { %>
                    <%- include('booking_card', { booking: booking, showCheckbox: false }) %>
                <% }) %>
            <% } %>
        </div>

        <div class="tab-pane fade" id="cancelled" role="tabpanel" aria-labelledby="cancelled-tab">
            <% if (cancelledBookings.length === 0) { %>
                <p class="text-muted">Không có phiếu đặt phòng nào bị hủy.</p>
            <% } else { %>
                <% cancelledBookings.forEach(booking => { %>
                     <%- include('booking_card', { booking: booking, showCheckbox: false }) %>
                <% }) %>
            <% } %>
        </div>

    </div> </main>

<%- include('../partials/footer') %>
