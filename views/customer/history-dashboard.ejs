<%- include('../partials/header') %>

<div class="container my-4">
  <h3 class="mb-4 text-center">Lịch sử đặt phòng</h3>

  <!-- Bộ lọc trạng thái -->
  <div class="d-flex justify-content-center mb-4 flex-wrap gap-2">
    <% statuses.forEach(st => { %>
      <a
        href="?status=<%= st.value %>"
        class="btn <%= filterStatus === st.value ? 'btn-primary' : 'btn-outline-primary' %>">
        <%= st.label %>
      </a>
    <% }) %>
  </div>

  <% if (bookings.length === 0) { %>
    <p class="text-center text-muted">Không có đơn đặt phòng nào phù hợp.</p>
  <% } else { %>
    <div class="row">
      <% bookings.forEach(b => { %>
        <div class="col-12 mb-1">
          <div class="card booking-card-horizontal shadow-sm">
            <div class="row g-3 align-items-stretch">
              <!-- Hình ảnh -->
              <div class="col-md-4">
                <img
                  src="/uploads/imgrooms/<%= b.Room?.image || 'default.png' %>"
                  class="img-fluid rounded-start booking-img"
                  alt="<%= b.Room?.roomName || 'Unknown Room' %>"
                >
              </div>

              <!-- Nội dung -->
              <div class="col-md-8 d-flex flex-column">
                <div class="card-body d-flex flex-column justify-content-between h-80">
                  <div>
                    <h5 class="card-title mb-1"><%= b.Room?.roomName || 'Phòng không xác định' %></h5>
                    <p class="text-muted mb-1">
                      Nhà cung cấp: <%= b.Room?.Provider?.providerName || 'Không rõ' %>
                    </p>
                    <p class="mb-1">Ngày đặt: <%= new Date(b.bookingDate).toLocaleDateString('vi-VN') %></p>
                    <p class="mb-1">
                      Nhận phòng: <%= new Date(b.checkInDate).toLocaleDateString('vi-VN') %> -
                      Trả phòng: <%= new Date(b.checkOutDate).toLocaleDateString('vi-VN') %>
                    </p>
                    <p class="mb-1">Tổng tiền: <%= b.totalAmount.toLocaleString() %> VND</p>
                    <div class="row">
                      <div class="col-8"> 
                        <p class="mb-1">Trạng thái: <strong><%= b.status %></strong></p>
                        <% if (b.invoice) { %>
                          <p class="text-success small mb-1">Hóa đơn: <%= b.invoice.status %></p>
                        <% } else { %>
                          <p class="text-muted small mb-1">Chưa có hóa đơn</p>
                        <% } %>
                      </div>

                    <div class="col-4"> 
                      <div class="text-end mt-2">
                        <a href="/customer/history-detail/<%= b.bookingId %>" class="btn btn-outline-primary btn-sm">
                          Xem chi tiết
                        </a>
                      </div>
                    </div>
                    </div>
                   
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>

<%- include('../partials/footer') %>
