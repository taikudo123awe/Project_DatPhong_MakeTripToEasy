<%- include('../partials/header') %>
<link rel="stylesheet" href="/css/detail.css" />

<main class="container-fluid p-0">
  <div class="card border-0 rounded-0">
    <div class="row g-0">
      <!-- PHẦN ẢNH PHÒNG -->
      <div class="col-md-6 p-0">
        <% if (room.image) { const imgs = room.image.split(";").filter(i =>
        i.trim() !== ""); const total = imgs.length; %>
        <div class="image-gallery">
          <!-- ẢNH CHÍNH -->
          <div class="main-image" onclick="openLightbox(0)">
            <img src="/<%= imgs[0] %>" alt="Main Image" loading="lazy" />
          </div>

          <!-- ẢNH PHỤ -->
          <div class="sub-images">
            <% imgs.slice(1, 5).forEach((img, index) => { %> <% if (index === 3
            && total > 5) { %>
            <div
              class="sub-image more-overlay"
              data-text="+<%= total - 4 %> ảnh"
              onclick="openLightbox(<%= index + 1 %>)"
            >
              <img src="/<%= img %>" alt="More Images" />
            </div>
            <% } else { %>
            <div class="sub-image" onclick="openLightbox(1)">
              <img src="/<%= img %>" alt="Sub Image" loading="lazy" />
            </div>
            <% } %> <% }) %>
          </div>
        </div>
        <% } else { %>
        <div class="text-center p-5 bg-light text-muted">
          <i class="fa-solid fa-image fa-3x mb-2"></i>
          <p>Phòng này chưa có hình ảnh.</p>
        </div>
        <% } %>
      </div>

      <!-- THÔNG TIN PHÒNG -->
      <div class="col-md-6 p-4 p-md-5 bg-light">
        <h2 class="text-uppercase fw-bold text-primary mb-4">
          <i class="fa-solid fa-bed me-2"></i> <%= room.roomName %>
        </h2>

        <ul class="list-unstyled mb-4">
          <li>
            <i class="fa-solid fa-location-dot text-danger me-2"></i
            ><strong>Địa chỉ:</strong> <%= room.fullAddress %>
          </li>
          <li>
            <i class="fa-solid fa-user-group text-success me-2"></i
            ><strong>Sức chứa:</strong> <%= room.capacity %> người
          </li>
          <li>
            <i class="fa-solid fa-coins text-warning me-2"></i
            ><strong>Giá:</strong> <%= room.price.toLocaleString() %> VND / đêm
          </li>
          <li>
            <i class="fa-solid fa-wifi text-info me-2"></i
            ><strong>Tiện ích:</strong> <%= room.amenities %>
          </li>
        </ul>

        <div class="mb-4">
          <h5 class="fw-bold text-secondary">
            <i class="fa-solid fa-info-circle me-2"></i>Mô tả
          </h5>
          <p class="text-muted"><%= room.description %></p>
        </div>

        <hr />

        <div class="mb-4">
          <h5 class="fw-bold text-secondary">
            <i class="fa-solid fa-user-tie me-2"></i>Nhà cung cấp
          </h5>
          <p><strong>Tên:</strong> <%= room.Provider?.providerName %></p>
          <p><strong>Email:</strong> <%= room.Provider?.email %></p>
          <p><strong>SĐT:</strong> <%= room.Provider?.phoneNumber %></p>
        </div>

        <div class="d-flex gap-3 mt-4">
          <a href="/" class="btn btn-outline-secondary px-4">
            <i class="fa-solid fa-arrow-left me-2"></i> Quay lại
          </a>
          <a
            href="/customer/bookings/<%= room.roomId %>"
            class="btn btn-primary px-4"
          >
            <i class="fa-solid fa-calendar-check me-2"></i> Đặt phòng ngay
          </a>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- ===== LIGHTBOX FULL MÀN HÌNH ===== -->
<div id="lightbox" class="lightbox">
  <span class="close-btn" onclick="closeLightbox()">&times;</span>
  <img id="lightbox-img" src="" alt="Phóng to ảnh" />
  <button class="prev-btn" onclick="changeImage(-1)">&#10094;</button>
  <button class="next-btn" onclick="changeImage(1)">&#10095;</button>
</div>

<!-- Dữ liệu ảnh dạng JSON -->
<script id="room-data" type="application/json">
  <%- JSON.stringify(room.image.split(";").filter(i => i.trim() !== "")) %>
</script>

<!-- File JS riêng -->
<script src="/javascript/detail.js"></script>
<%- include('../partials/footer') %>
